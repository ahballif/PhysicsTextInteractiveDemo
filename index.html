<!doctype html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.27.2/full/pyodide.js"></script>
  </head>

  <body>
    <p>
      You can execute any Python code. Just enter something in the box below and
      click the button.
    </p>
    <input id="code" value="sum([1, 2, 3, 4, 5])" />
    <button onclick="evaluatePython()">Run</button>
    <br />
    <br />
    <div>Output:</div>
    <textarea id="output" style="width: 100%;" rows="6" disabled></textarea>

    <script>
      const output = document.getElementById("output");
      const code = document.getElementById("code");

      function addToOutput(s) {
        output.value = ">>>" + 'x + 5' + "\n" + s + "\n";
      }

      output.value = "Initializing...\n";
      // init Pyodide
      async function main() {
        let pyodide = await loadPyodide();
        output.value += "Ready!\n";
        return pyodide;
      }
      let pyodideReadyPromise = main();

      async function evaluatePython() {
        let pyodide = await pyodideReadyPromise;
        try {
          await pyodide.loadPackage("micropip");
          const micropip = pyodide.pyimport("micropip");
          await micropip.install('numpy');
          await micropip.install('matplotlib')
          let outstr = pyodide.runPython(`
            import numpy as np
            from matplotlib import pyplot as plt
            x = np.arange(10)
            y = x**2 - 2
            plt.plot(x, y)
          `);
          // output = pyodide.globals.get('y').toJs();
          addToOutput(outstr);
          
        } catch (err) {
          addToOutput(err);
        }
      }
      
      async function main() {
        let pyodide = await loadPyodide();
        console.log(
          pyodide.runPython(`
              import sys
              sys.version
          `)
        );
        await pyodide.loadPackage("matplotlib");
        pyodide.runPython(`
            import matplotlib
            import numpy as np
            matplotlib.use("module://matplotlib_pyodide.html5_canvas_backend")
            import matplotlib.cm as cm
            from matplotlib import pyplot as plt
            delta = 0.025
            x = y = np.arange(-3.0, 3.0, delta)
            X, Y = np.meshgrid(x, y)
            Z1 = np.exp(-(X**2) - Y**2)
            Z2 = np.exp(-((X - 1) ** 2) - (Y - 1) ** 2)
            Z = (Z1 - Z2) * 2
            plt.figure()
            plt.imshow(
            Z,
            interpolation="bilinear",
            cmap=cm.RdYlGn,
            origin="lower",
            extent=[-3, 3, -3, 3],
            vmax=abs(Z).max(),
            vmin=-abs(Z).max(),
            )
            plt.show()
          `);
      }
      main();

      
    </script>
    
  </body>

</html>